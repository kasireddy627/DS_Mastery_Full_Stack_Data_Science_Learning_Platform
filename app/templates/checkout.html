{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h3>Checkout</h3>
        <p>Price: <strong>₹{{ total }}</strong> — {{ months }} month(s)</p>

        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
        <button id="rzp-button" class="btn btn-success w-100">Pay ₹{{ total }}</button>

        <script>
          const options = {
            "key": "{{ key_id }}",
            "amount": "{{ amount }}",
            "currency": "INR",
            "name": "DS Mastery",
            "description": "{{ months }} month subscription",
            "order_id": "{{ order.id }}",
            "handler": function (response){
              const form = document.createElement('form');
              form.method = 'POST';
              form.action = "{{ url_for('payments.verify_payment') }}";
              const add = (k,v) => { const i=document.createElement('input'); i.type='hidden'; i.name=k; i.value=v; form.appendChild(i); }
              add('razorpay_payment_id', response.razorpay_payment_id);
              add('razorpay_order_id', response.razorpay_order_id);
              add('razorpay_signature', response.razorpay_signature);
              add('months', "{{ months }}");
              document.body.appendChild(form);
              form.submit();
            },
            "prefill": { "email": "{{ current_user.email }}", "name": "{{ current_user.full_name or '' }}" }
          };
          const rzp1 = new Razorpay(options);
          document.getElementById('rzp-button').onclick = (e) => { rzp1.open(); e.preventDefault(); }
        </script>
      </div>
    </div>
  </div>
</div>
{% endblock %}
